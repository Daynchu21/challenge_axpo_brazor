#!/bin/sh
. "$(dirname "$0")/_/husky.sh"

echo "ğŸ” Running pre-commit checks..."

# Get the root directory of the git repository
ROOT_DIR=$(git rev-parse --show-toplevel)

# 1. Run dotnet format on C# files
echo "ğŸ“ Running dotnet format..."
cd "$ROOT_DIR"
dotnet format --verify-no-changes --verbosity quiet
if [ $? -ne 0 ]; then
  echo "âŒ Code formatting issues found. Running dotnet format to fix..."
  dotnet format
  echo "âœ… Code formatted. Please review and stage the changes."
  exit 1
fi
echo "âœ… C# formatting check passed"

# 2. Run prettier on JS/CSS/Razor files
echo "ğŸ’… Running prettier..."
cd "$ROOT_DIR/BlazorApp"
npm run format:check
if [ $? -ne 0 ]; then
  echo "âŒ Prettier formatting issues found. Running prettier to fix..."
  npm run format
  echo "âœ… Files formatted. Please review and stage the changes."
  exit 1
fi
echo "âœ… Prettier check passed"

# 3. Run tests
echo "ğŸ§ª Running tests..."
cd "$ROOT_DIR/BlazorApp.Tests"
dotnet test --verbosity quiet --nologo
if [ $? -ne 0 ]; then
  echo "âŒ Tests failed. Please fix the tests before committing."
  exit 1
fi
echo "âœ… All tests passed"

echo "âœ¨ All pre-commit checks passed!"
exit 0

dotnet husky run
